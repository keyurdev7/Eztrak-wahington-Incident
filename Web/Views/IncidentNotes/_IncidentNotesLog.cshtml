@model List<ViewModels.Incident.IncidentNoteViewModel>
<style>
    #imgPreviewModal.modal {
        display: none;
        position: fixed;
        z-index: 9999;
        padding-top: 60px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,61%);
    }

    #imgPreviewModal .modal-content {
        display: block;
        margin: auto;
        max-width: 50%;
        max-height: 80%;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    #imgPreviewModal .close {
        position: absolute;
        top: 20px;
        right: 35px;
        color: white;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
        opacity:1;
    }
</style>
<div class="card communication-sec">
    <h3>Communication Log</h3>
    @foreach (var note in Model)
    {
        <div class="log-item">
            <div class="log-avatar"><i class="fa fa-user"></i></div>
            <div class="log-content">
                <div class="log-header">
                    @note.Author
                    <span class="tag @(note.NoteType.ToLower())">@note.NoteType</span>
                    <span class="log-time">@note.CreatedOn.ToString("MMM dd yyyy hh:mm tt")</span>

                    @if (!string.IsNullOrEmpty(note.FileUrl))
                    {
                        <span class="attached">
                            <i class="fa fa-paperclip"></i>
                            <a href="@System.IO.Path.GetFileName(note.FileUrl)" class="attachment">
                                @System.IO.Path.GetFileName(note.FileUrl)
                            </a>
                            
                        </span>
                    }
                </div>
                <div class="log-text">@note.Content</div>
            </div>
        </div>
    }
</div>
<div id="imgPreviewModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="previewImg" src="~/img/banner.jpg">
</div>

<script>
        document.querySelectorAll('.attached').forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault(); // prevent normal link behavior
        const modal = document.getElementById("imgPreviewModal");
        const modalImg = document.getElementById("previewImg");
        modal.style.display = "block";
        modalImg.src = this.href; // show clicked image
      });
    });

    // Close modal on click of X
    document.querySelector('.close').onclick = function () {
      document.getElementById("imgPreviewModal").style.display = "none";
    };

    // Close modal when clicking outside the image
    window.onclick = function (event) {
      const modal = document.getElementById("imgPreviewModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    };
</script>